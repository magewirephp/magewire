<?php
/**
 * @author HyvÃ¤ Themes <info@hyva.io>
 *
 * For the full copyright and license information, please view the LICENSE.txt
 * file that was distributed with this source code.
 */

declare(strict_types=1);

/** @var Escaper $escaper */
/** @var Template $block */
/** @var ViewModelRegistry $viewModels */
/** @var Escaper $escaper */

use Hyva\CheckoutCore\ViewModel\Page\Loader as LoaderViewModel;
use Hyva\Theme\Model\ViewModelRegistry;
use Magento\Framework\Escaper;
use Magento\Framework\View\Element\Template;

$loader = $viewModels->require(LoaderViewModel::class);
?>
<div id="magewire-loader"
     class="fixed
            top-0 left-0 right-0 bottom-0
            w-full h-screen
            z-50
            overflow-hidden
            bg-white bg-opacity-90"
     x-data="{ queue: [], history: [], active: 0 }"
     x-show="queue.length"
     x-on:magewire:loader:start.window="queue.push($event.detail); active = $event.detail.title ? queue.length - 1 : active"
     x-on:magewire:loader:stopover.window="history = queue, queue.push($event.detail); active = $event.detail.title ? queue.length - 1 : active"
     x-on:magewire:loader:stop.window="queue = []"
     x-transition:enter="transition duration-300"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition duration-200"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     x-cloak
     role="status"
>
    <div class="flex flex-col justify-center items-center h-screen w-full space-y-6">
        <svg class="animate-spin h-8 w-8"
             xmlns="http://www.w3.org/2000/svg"
             fill="none"
             viewBox="0 0 24 24"
        >
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="shadow-md" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>

        <ul class="relative w-full items-center justify-center">
            <template x-for="(item, index) in queue" :key="item.key">
                <li class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                    <div class="mt-4 font-bold text-md"
                         x-show="active === index"
                         x-text="item.title"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0"
                         x-transition:enter-end="opacity-100"
                         x-transition:leave="transition duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-8"
                    >
                        <!-- Magewire: Title Placeholder -->
                    </div>
                </li>
            </template>
        </ul>
    </div>
</div>
